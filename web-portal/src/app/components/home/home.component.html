<section class="list-section" *transloco="let t; prefix: 'home'">
  <div class="main-content">
    <div class="items-container">
      <div class="search-bar">
        <input
          class="search-input"
          [formControl]="searchControl"
          [placeholder]="t('searchPlaceholder')"
        />
      </div>

      <div class="filters-container" style="display: flex; gap: 1rem">
        <select class="form-input" [formControl]="groupIdControl">
          <option [ngValue]="null">{{ t('filters.allGroups') }}</option>

          @if (groups$ | async; as groups) {
            @for (group of groups; track group.id) {
              <option [ngValue]="group.id">{{ group.name }}</option>
            }
          }
        </select>

        <select class="form-input" [formControl]="fuelTypeControl">
          <option [ngValue]="null">{{ t('filters.allFuels') }}</option>
          <option value="Gasoline">{{ t('fuel.Gasoline') }}</option>
          <option value="Diesel">{{ t('fuel.Diesel') }}</option>
          <option value="Alcohol">{{ t('fuel.Alcohol') }}</option>
          <option value="Gas">{{ t('fuel.Gas') }}</option>
        </select>
      </div>
    </div>

    @if (viewModel$ | async; as vm) {
      @if (!vm.rentalStatus.canRent) {
        <div class="rent-blocked-banner">
          <strong>{{ t('rentBlocked.title') }}</strong>
          <div class="rent-blocked-messages">
            @if (vm.rentalStatus.reason === 'ActiveRentalExists') {
              @if (vm.rentalStatus.rental?.vehicleLicensePlate; as plate) {
                {{ t('rentBlocked.reasons.activeRentalExists', { plate }) }}
              } @else {
                {{ t('rentBlocked.reasons.activeRentalExistsWithoutPlate') }}
              }
            } @else if (vm.rentalStatus.reason === 'ProfileIncomplete') {
              {{ t('rentBlocked.reasons.profileIncomplete') }}
              <gs-buttons
                class="button"
                [buttonType]="buttonType.Link"
                [routerLink]="['/account', 'edit']"
                [variant]="variantType.Outline"
                text=""
                bootstrapIcon="bi-arrow-right-square"
              >
              </gs-buttons>
            } @else if (vm.rentalStatus.reason === 'NotAuthenticated') {
              {{ t('rentBlocked.reasons.notAuthenticated') }}
            } @else {
              {{ t('rentBlocked.reasons.unknown') }}
            }
          </div>
        </div>
      }

      <div class="list">
        @for (vehicle of vm.state.items; track vehicle.id) {
          <div class="item">
            <app-vehicle-card
              [vehicle]="vehicle"
              [imageBaseUrl]="urlS3"
              [canRent]="vm.rentalStatus.canRent"
              [rentalBlockReason]="vm.rentalStatus.reason"
              [activeRentalPlate]="vm.rentalStatus.rental?.vehicleLicensePlate ?? null"
            >
            </app-vehicle-card>
          </div>
        } @empty {
          <p class="empty-state">{{ t('noVehiclesFound') }}</p>
        }
      </div>

      @if (vm.state.totalCount > vm.state.pageSize) {
        <div class="pagination">
          <gs-buttons
            [buttonType]="buttonType.Default"
            [text]="t('pagination.prev')"
            [variant]="variantType.Outline"
            [disabled]="vm.state.currentPage === 1"
            (click)="onPageChange(vm.state.currentPage - 1)"
          >
          </gs-buttons>

          <span>
            {{
              t('pagination.info', {
                page: vm.state.currentPage,
                total: Math.ceil(vm.state.totalCount / vm.state.pageSize),
              })
            }}
          </span>

          <gs-buttons
            [buttonType]="buttonType.Default"
            [text]="t('pagination.next')"
            [variant]="variantType.Outline"
            [disabled]="vm.state.currentPage * vm.state.pageSize >= vm.state.totalCount"
            (click)="onPageChange(vm.state.currentPage + 1)"
          >
          </gs-buttons>
        </div>
      }
    } @else {
      <div class="loading-skeleton">{{ t('loading') }}</div>
    }
  </div>
</section>
